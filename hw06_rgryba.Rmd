---
title: "Stat547 Homework 6"
author: "Rowenna Gryba"
date: "2018-11-05"
output: github_document
---
  
```{r}
suppressPackageStartupMessages(library(tidyverse))
library(repurrrsive)
library(gapminder)
```

##Question 6 - Write a function for gapminder data
This function runs a linear model to model the relationship between two variables using a grouping variable. The output is a dataframe with the variable and associated lm output, for those models that had significant p-values.
The example below uses the gapminder data and compares population to year for each country.

```{r echo=TRUE}
str(gapminder)

lm_function <- function(df, y, x, group_var) {
  group_var <-  enquo(group_var)
  df %>%
    group_by_(group_var) %>%
    nest() %>%
    mutate(fit = map(data, ~ lm(.[[y]] ~ .[[x]], data=.))) %>%
    mutate(output = map(fit, broom::tidy)) %>%
    unnest(output) %>%
    filter(any(p.value < 0.05)) %>%
    mutate(term = replace(term, term == ".[[x]]", "year"))
}

lm_function(df=gapminder,y="pop", x="year", group_var=country)
```